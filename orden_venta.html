<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orden de Venta - Ferretería Marsella</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Librerías externas -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


<style>

</style>
</head>

<body class="bg-light">
    <header class="container-fluid bg-white text-dark p-3 shadow">
        <div class="d-flex justify-content-between align-items-center">
            <img src="img/MARSELLA (2).png" alt="Logo Ferretería Marsella" style="width: auto; height: 60px; object-fit: contain;" class="rounded animate__animated animate__fadeIn">
            <div>
                <span class="me-3">Bienvenido/a: <strong id="userName">Millaray Esposito</strong></span>
                <button onclick="toggleDarkMode()" class="btn btn-outline-dark" id="darkModeBtn"><i class="fas fa-moon me-2"></i>Modo Noche</button>
                <a href="logout.html" class="btn btn-danger ms-2">Cerrar Sesión</a>
            </div>
        </div>
    </header>

    <main class="container mt-4">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html" class="text-dark"><i class="fas fa-home"></i></a></li>
                <li class="breadcrumb-item active" aria-current="page">Orden de Venta</li>
            </ol>
        </nav>

 <body class="bg-light p-4">
  <h2 class="mb-4 text-dark">Orden de Venta</h2>

  <!-- FORMULARIO PRINCIPAL -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="mb-3">
        <label>Cliente (RUT):</label>
        <div class="input-group">
          <input type="text" class="form-control" id="rutCliente" placeholder="Ej: 12345678-9">
          <button class="btn btn-outline-primary" onclick="buscarCliente()">
            <i class="fas fa-arrow-right"></i>
          </button>
        </div>
      </div>

      <div class="mb-3">
        <label>Nombre:</label>
        <input type="text" class="form-control" id="nombreCliente" readonly>
      </div>

      <div class="mb-3">
        <label>Persona de contacto:</label>
        <input type="text" class="form-control" id="contactoCliente" readonly>
      </div>

      <div class="mb-3">
        <label>OC / Ref:</label>
        <input type="text" class="form-control" id="ocCliente" readonly>
      </div>

      <div class="mb-3">
        <label>Moneda local:</label>
        <select class="form-control">
          <option>CLP</option>
        </select>
      </div>
    </div>

    <div class="col-md-6">
      <div class="mb-3">
        <label>N°:</label>
        <select class="form-control" id="numeroTipo" onchange="toggleNumeroInput()">
          <option value="primario">Primario</option>
          <option value="manual">Manual</option>
        </select>
        <input type="text" class="form-control mt-2" id="numeroManual" style="display: none;" placeholder="Ingrese número manual">
      </div>

      <div class="mb-3">
        <label>Estado:</label>
        <select class="form-control">
          <option>Abiertos</option>
        </select>
      </div>

      <div class="mb-3">
        <label>Fecha de contabilización:</label>
        <input type="date" class="form-control">
      </div>

      <div class="mb-3">
        <label>Fecha de entrega:</label>
        <input type="date" class="form-control">
      </div>

      <div class="mb-3">
        <label>Fecha de documento:</label>
        <input type="date" class="form-control">
      </div>
    </div>
  </div>

        <!-- Pestañas -->
        <div class="card border-0 shadow">
            <div class="card-body">
                <style>
                /* Estilos generales de pestañas */
                .nav-tabs {
                    border-bottom: 2px solid #dee2e6;
                }
                .nav-tabs .nav-item {
                    margin-bottom: -2px;
                }
                .nav-tabs .nav-link {
                    border: none;
                    color: #495057;
                    padding: 12px 20px;
                    font-weight: 500;
                    transition: all 0.3s ease;
                    position: relative;
                }
                .nav-tabs .nav-link:hover {
                    border: none;
                    color: #dc3545;
                }
                .nav-tabs .nav-link:hover i {
                    color: #dc3545;
                }
                .nav-tabs .nav-link.active {
                    color: #dc3545;
                    background: transparent;
                    border-bottom: 2px solid #dc3545;
                }
                .nav-tabs .nav-link.active i {
                    color: #dc3545;
                }

                /* Estilos generales del formulario */
                .tab-pane {
                    padding: 20px;
                    background-color: #ffffff;
                    border-radius: 8px;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }
                .row {
                    margin-bottom: 20px;
                }
                .mb-3 {
                    margin-bottom: 1.5rem !important;
                }
                label {
                    font-weight: 600;
                    color: #333;
                    margin-bottom: 0.5rem;
                    display: block;
                }
                .form-control {
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    padding: 0.5rem 0.75rem;
                    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
                }
                .form-control:focus {
                    border-color: #80bdff;
                    outline: 0;
                    box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
                }
                select.form-control {
                    cursor: pointer;
                    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
                    background-repeat: no-repeat;
                    background-position: right 0.75rem center;
                    background-size: 16px 12px;
                    padding-right: 2rem;
                }
                input[type="date"].form-control {
                    min-height: 38px;
                }
                .d-flex {
                    gap: 1rem;
                }
                .me-3 {
                    margin-right: 1rem !important;
                }
                /* Estado Packing styles */
                .d-flex label:last-child {
                    background-color: #ffc107;
                    padding: 0.5rem 1rem;
                    border-radius: 4px;
                    color: #000;
                    margin-top: 2rem;
                }
                /* ESTILO PDF ORDEN DE VENTA */
                



                </style>

                <ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" data-bs-toggle="tab" href="#contenido">
      <i class="fas fa-box me-1"></i> Contenido
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-bs-toggle="tab" href="#logistica">
      <i class="fas fa-truck me-1"></i> Logística
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-bs-toggle="tab" href="#ventas">
      <i class="fas fa-dollar-sign me-1"></i> Ventas
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-bs-toggle="tab" href="#finanzas">
      <i class="fas fa-coins me-1"></i> Finanzas
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-bs-toggle="tab" href="#anexos">
      <i class="fas fa-paperclip me-1"></i> Anexos
    </a>
  </li>
</ul>


                </ul>                                <div class="tab-content mt-3" id="myTabContent">
                    
<!-- Contenido -->
<div class="tab-pane fade show active" id="contenido">
    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <thead>
                <tr class="bg-light">
                    <th class="p-3" style="min-width: 150px; font-size: 0.9rem;">Código</th>
                    <th class="p-3" style="min-width: 350px; font-size: 0.9rem;">Descripción del artículo</th>
                    <th class="p-3" style="min-width: 150px; font-size: 0.9rem;">Almacén</th>
                    <th class="p-3" style="min-width: 100px; font-size: 0.9rem;">Cant Vta</th>
                    <th class="p-3" style="min-width: 170px; font-size: 0.9rem;">Precio venta</th>
                    <th class="p-3" style="min-width: 170px; font-size: 0.9rem;">Total (ML)</th>
                    <th class="p-3" style="min-width: 170px; font-size: 0.9rem;">Solicita compra</th>
                    <th class="p-3" style="min-width: 170px; font-size: 0.9rem;">Proveedor</th>
                    <th class="p-3" style="min-width: 200px; font-size: 0.9rem;">Cantidad a comprar</th>
                    <th class="p-3" style="min-width: 170px; font-size: 0.9rem;">Precio compra</th>
                    <th class="p-3" style="min-width: 150px; font-size: 0.9rem;">Margen</th>
                    <th class="p-3" style="min-width: 200px; font-size: 0.9rem;">Fecha solicitud</th>
                    <th class="p-3" style="min-width: 150px; font-size: 0.9rem;">% comisión</th>
                    <th class="p-3" style="min-width: 200px; font-size: 0.9rem;">Plazo de entrega</th>
                    <th class="p-3" style="min-width: 200px; font-size: 0.9rem;">Status de picking</th>
                    <th class="p-3" style="min-width: 200px; font-size: 0.9rem;">Almacén destino</th>
                    <th class="p-3" style="min-width: 150px; font-size: 0.9rem;">Cod. QBLI</th>
                    <th class="p-3" style="min-width: 150px; font-size: 0.9rem;">Valor QBLI</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="p-2">
                        <div class="input-group">
                            <input type="text" class="form-control form-control-sm codigo-articulo" placeholder="Ej: F123456">
                            <button class="btn btn-outline-secondary" type="button" onclick="buscarArticuloDesdeBoton(this)">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </td>
                    <td class="p-2"><input type="text" class="form-control form-control-sm descripcion" readonly></td>
                    <td class="p-2"><input type="text" class="form-control form-control-sm" value="A01"></td>
                    <td class="p-2"><input type="text" class="form-control form-control-sm cantidad" onchange="recalcularTotal(this)"></td>
                    <td class="p-2"><input type="text" class="form-control form-control-sm precio" onchange="recalcularTotal(this)"></td>
                    <td class="p-2"><input type="text" class="form-control form-control-sm total" readonly></td>
                    <td class="p-2">
                        <select class="form-select form-select-sm solicita-compra">
                            <option value="No">No</option>
                            <option value="Sí">Sí</option>
                        </select>
                    </td>
                    <td class="p-2">
                        <div class="input-group">
                            <input type="text" class="form-control form-control-sm proveedor" placeholder="Seleccione proveedor" readonly>
                            <button class="btn btn-outline-secondary" type="button" onclick="abrirModalProveedor(this)">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </td>
                    <td class="p-2"><input type="number" class="form-control form-control-sm"></td>
                    <td class="p-2"><input type="number" class="form-control form-control-sm"></td>
                    <td class="p-2"><input type="number" class="form-control form-control-sm"></td>
                    <td class="p-2"><input type="date" class="form-control form-control-sm fecha-solicitud"></td>
                    <td class="p-2"><input type="number" class="form-control form-control-sm"></td>
                    <td class="p-2"><input type="text" class="form-control form-control-sm"></td>
                    <td class="p-2"><input type="text" class="form-control form-control-sm"></td>
                    <td class="p-2"><input type="text" class="form-control form-control-sm"></td>
                    <td class="p-2"><input type="text" class="form-control form-control-sm"></td>
                    <td class="p-2"><input type="text" class="form-control form-control-sm"></td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Modal para seleccionar proveedor -->
<div class="modal fade" id="modalProveedores" tabindex="-1" aria-labelledby="modalProveedoresLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalProveedoresLabel">GET PROVEEDOR</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <div class="input-group mb-3">
          <span class="input-group-text">Buscar Proveedor</span>
          <input type="text" class="form-control" id="buscarRUT" placeholder="">
          <button class="btn btn-outline-primary" onclick="filtrarProveedores()">Buscar</button>
        </div>

        <table class="table table-striped table-bordered">
          <thead class="table-light">
            <tr>
              <th>Código SN</th>
              <th>Nombre SN</th>
            </tr>
          </thead>
          <tbody id="tablaProveedores">
            <!-- Filas generadas dinámicamente -->
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
      </div>
    </div>
  </div>
</div>





<!-- Logística -->
<div class="tab-pane fade show active" id="logistica">
    <div class="row">
        <div class="col-md-12">
            <!-- Módulo Destino -->
            <div class="mb-4">
                <label class="form-label fw-bold text-danger">Destino</label>
                <div class="input-group">
                    <select class="form-select border-secondary" style="background-color: #f8f9fa;">
                        <option>Dirección 1</option>
                        <option>Dirección 2</option>
                    </select>
                    <input type="text" class="form-control border-secondary" placeholder="PDQ IQUIQUE, CHILE" value="PDQ IQUIQUE, CHILE" style="background-color: #f8f9fa;" readonly>
                    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="modal" data-bs-target="#modalEditarDireccion">Editar</button>
                </div>
            </div>

            <!-- Módulo Destinatario de Factura -->
            <div class="mb-4">
                <label class="form-label fw-bold text-danger">Destinatario de Factura</label>
                <div class="input-group">
                    <select class="form-select border-secondary" style="background-color: #f8f9fa;">
                        <option>Dirección 1</option>
                        <option>Dirección 2</option>
                    </select>
                    <input type="text" class="form-control border-secondary" placeholder="PDQ IQUIQUE, CHILE" value="PDQ IQUIQUE, CHILE" style="background-color: #f8f9fa;" readonly>
                    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="modal" data-bs-target="#modalEditarDireccion">Editar</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para editar dirección -->
<div class="modal fade" id="modalEditarDireccion" tabindex="-1" aria-labelledby="modalEditarDireccionLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalEditarDireccionLabel">Editar Dirección</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <label for="direccionInput" class="form-label">Dirección:</label>
                <input type="text" id="direccionInput" class="form-control" value="PDQ IQUIQUE, CHILE">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="guardarDireccion()">Guardar</button>
            </div>
        </div>
    </div>
</div>

<script>
    function guardarDireccion() {
        const nuevaDireccion = document.getElementById('direccionInput').value;
        const inputsDireccion = document.querySelectorAll('input[placeholder="PDQ IQUIQUE, CHILE"]');
        
        // Actualizar todos los campos de dirección con el nuevo valor
        inputsDireccion.forEach(input => {
            input.value = nuevaDireccion;
        });

        // Cerrar el modal
        const modal = bootstrap.Modal.getInstance(document.getElementById('modalEditarDireccion'));
        modal.hide();
    }
</script>
                    <!-- Ventas -->
                    <style>
                        .tab-pane {
                            padding: 20px;
                            background-color: #ffffff;
                            border-radius: 8px;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        }

                        .row {
                            margin-bottom: 20px;
                        }

                        .mb-3 {
                            margin-bottom: 1.5rem !important;
                        }

                        label {
                            font-weight: 600;
                            color: #333;
                            margin-bottom: 0.5rem;
                            display: block;
                        }

                        .form-control {
                            border: 1px solid #ddd;
                            border-radius: 4px;
                            padding: 0.5rem 0.75rem;
                            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
                        }

                        .form-control:focus {
                            border-color: #80bdff;
                            outline: 0;
                            box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
                        }

                        select.form-control {
                            cursor: pointer;
                            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
                            background-repeat: no-repeat;
                            background-position: right 0.75rem center;
                            background-size: 16px 12px;
                            padding-right: 2rem;
                        }

                        input[type="date"].form-control {
                            min-height: 38px;
                        }

                        .d-flex {
                            gap: 1rem;
                        }

                        .me-3 {
                            margin-right: 1rem !important;
                        }

                        /* Estado Packing styles */
                        .d-flex label:last-child {
                            background-color: #ffc107;
                            padding: 0.5rem 1rem;
                            border-radius: 4px;
                            color: #000;
                            margin-top: 2rem;
                        }
                    </style>
                    <div class="tab-pane fade" id="ventas">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label>Tipo orden:</label>
                                    <select class="form-control">
                                        <option>Seleccionar</option>
                                        <option>Entrega - Entrega</option>
                                        <option>Reserva - Reserva</option>
                                        <option>Solo traslado - Solo traslado</option>
                                        <option>Solo traslado con ajuste de stock - Solo traslado con ajuste de stock</option>
                                        <option>En espera de OC - En espera de OC</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label>Forma de pago:</label>
                                    <input type="text" class="form-control">
                                </div>
                                <div class="mb-3">
                                    <label>Documento Despacho:</label>
                                    <select class="form-control">
                                        <option>Seleccionar</option>
                                        <option>Factura - Factura</option>
                                        <option>Guía despacho - Guía despacho </option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label>FE tipo de doc de Ref 1:</label>
                                    <select class="form-control">
                                        <option>Seleccionar</option>
                                        <option value="30">30 - Factura</option>
                                        <option value="32">32 - Factura exenta de IVA</option>
                                        <option value="33">33 - Factura electrónica</option>
                                        <option value="34">34 - Factura exenta electrónica</option>
                                        <option value="35">35 - Boleta</option>
                                        <option value="38">38 - Boleta exenta</option>
                                        <option value="39">39 - Boleta electrónica</option>
                                        <option value="41">41 - Boleta exenta electrónica</option>
                                        <option value="45">45 - Factura de compra</option>
                                        <option value="46">46 - Factura de compra electrónica</option>
                                        <option value="50">50 - Guía de despacho</option>
                                        <option value="52">52 - Guía de despacho electónica</option>
                                        <option value="55">55 - Nota de débito</option>
                                        <option value="56">56 - Nota de débito electrónica</option>
                                        <option value="60">60 - Nota de crédito</option>
                                        <option value="61">61 - Nota de crédito electrónica</option>
                                        <option value="801">801 - Orden de Compra</option>
                                        <option value="802">802 - Nota de Pedido</option>
                                        <option value="803">803 - Contrato</option>
                                        <option value="804">804 - Resolución</option>
                                        <option value="805">805 - Proceso Chile Compra</option>
                                        <option value="806">806 - Ficha Chile Compra</option>
                                        <option value="999">999 - CHEQUE</option>
                                        <option value="A">A - TRANSFERENCIA ELECTRONICA</option>
                                        <option value="B">B - DEPOSITO BANCARIO</option>
                                        <option value="CONT">CONT - EFECTIVO</option>
                                        <option value="DEB">DEB - Tarjeta de débito</option>
                                        <option value="HES">HES - Hoja de Entrada de Servicios</option>
                                        <option value="MIG">MIG - MIGO</option>
                                        <option value="MIGO">MIGO - MIGO2</option>
                                    </select>                                </div>
                                <div class="mb-3">
                                    <label>Valor flete estimado:</label>
                                    <input type="text" class="form-control">
                                </div>
                                <div class="mb-3">
                                    <label>Flete pagado por:</label>
                                    <select class="form-control">
                                        <option>Seleccionar</option>
                                        <option>GGH - GGH</option>
                                        <option>Cliente - Cliente</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label>FE fecha Ref 1:</label>
                                    <input type="date" class="form-control">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3 d-flex">
                                    <div class="me-3">
                                        <label>Fecha de entrega:</label>
                                        <input type="date" class="form-control">
                                    </div>
                                    <div>
                                        <label>Estado: Packing</label>
                                      
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label>Correo de cliente:</label>
                                    <input type="text" class="form-control">
                                </div>
                                
                                <div class="mb-3">
                                    <label>Tipo de despacho:</label>
                                    <select class="form-control">
                                        <option>Seleccionar</option>
                                        <option>GGH - GGH</option>
                                        <option>Retira cliente - Retira cliente</option>
                                        <option>Agenda - Agenda</option>
                                        <option>Transporte externo - Transporte externo </option>
                                        <option>Calibración - Calibración </option>
                                        <option>Sin OC - Sin OC </option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label>Centro de costo:</label>
                                    <input type="text" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>                    <!-- Finanzas -->
                    <div class="tab-pane fade" id="finanzas">
                        <p>Contenido de Finanzas (En desarrollo)</p>
                    </div>

<!-- Anexos -->
<div class="tab-pane fade show" id="anexos">
  <div class="card">
    <div class="card-body">
      <h5 class="mb-3 text-danger">Tabla de Anexos</h5>

      <div class="table-responsive">
        <table class="table table-bordered">
          <thead class="table-light">
            <tr>
              <th class="text-center">#</th>
              <th>Vía de Acceso Destino</th>
              <th>Nombre de Archivo</th>
              <th>Fecha del Anexo</th>
              <th>Texto Libro</th>
              <th class="text-center">Acciones</th>
            </tr>
          </thead>
          <tbody id="tablaAnexosBody">
            <tr>
              <td class="text-center">1</td>
              <td><input type="text" class="form-control ruta" readonly></td>
              <td><input type="text" class="form-control nombre-archivo" readonly></td>
              <td><input type="date" class="form-control fecha-anexo"></td>
              <td><input type="text" class="form-control texto-libro"></td>
              <td class="text-center">
                <input type="file" class="form-control form-control-sm archivo" onchange="procesarArchivo(this)">
                <div class="btn-group mt-2">
                  <button class="btn btn-outline-primary btn-sm" onclick="visualizarArchivo(this)">Visualizar</button>
                  <button class="btn btn-outline-danger btn-sm" onclick="borrarFila(this)">Borrar</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <button class="btn btn-outline-success mt-2" onclick="agregarFilaAnexo()">
        <i class="fas fa-plus"></i> Agregar Anexo
      </button>
    </div>
  </div>
</div>
        
        <div class="container mt-4">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label>Empleado de ventas:</label>
                                            <select class="form-control">
                                                <option>Seleccionar</option>
                                                <option>Vendedora - Grecia Castro</option>
                                                <option>Vendedora - Paola Rvera </option>

                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label>Propietario:</label>
                                            <input type="text" class="form-control">
                                        </div>
                                        <div class="mb-3">
                                            <label>Comentarios:</label>
                                            <textarea class="form-control" rows="3"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

<button class="btn btn-primary btn-lg" onclick="generarOrdenVenta()">
  <i class="fas fa-file-invoice"></i> Generar Orden de Venta
</button>


        </main>

    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5 class="border-bottom pb-2">Ferretería Marsella</h5>
                    <p class="small">Sistema Integrado de Gestión de Bodega</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
<!-- jsPDF v2.5.1 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- AutoTable compatible -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>




<script>
    // =======================
    // MODO OSCURO
    // =======================
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        const isDarkMode = document.body.classList.contains('dark-mode');
        localStorage.setItem('darkMode', isDarkMode);

        const darkModeBtn = document.getElementById('darkModeBtn');
        if (isDarkMode) {
            darkModeBtn.innerHTML = '<i class="fas fa-sun me-2"></i>Modo Día';
        } else {
            darkModeBtn.innerHTML = '<i class="fas fa-moon me-2"></i>Modo Noche';
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const isDarkMode = localStorage.getItem('darkMode') === 'true';
        if (isDarkMode) {
            toggleDarkMode();
        }
    });

    // =======================
    // CLIENTES
    // =======================
    const clientes = {
        "12345678-9": {
            nombre: "KOMATSU CHILE S.A.",
            contacto: "Carlos Moya",
            ocRef: "OC-001122"
        },
        "11111111-1": {
            nombre: "3M CHILE LIMITADA",
            contacto: "Valentina Reyes",
            ocRef: "REF-7890"
        },
        "22222222-2": {
            nombre: "MAKITA CHILE S.A.",
            contacto: "Valentina Reyes",
            ocRef: "REF-7890"
        },
        "33333333-3": {
            nombre: "CONSTRUCTORA DEL SUR S.A",
            contacto: "Valentina Reyes",
            ocRef: "REF-7890"
        },
         "44444444-4": {
            nombre: "CODELCO ",
            contacto: "Valentina Reyes",
            ocRef: "REF-7890"
        },
    };

    function validarRut(rut) {
        return /^\d{7,8}-[\dkK]$/.test(rut);
    }

    function buscarCliente() {
        const rut = document.getElementById("rutCliente").value.trim();

        if (!validarRut(rut)) {
            alert("Formato de RUT inválido. Ejemplo válido: 12345678-9");
            return;
        }

        const cliente = clientes[rut];

        if (cliente) {
            document.getElementById("nombreCliente").value = cliente.nombre;
            document.getElementById("contactoCliente").value = cliente.contacto;
            document.getElementById("ocCliente").value = cliente.ocRef;
        } else {
            alert("Cliente no encontrado. Verifique el RUT.");
            document.getElementById("nombreCliente").value = "";
            document.getElementById("contactoCliente").value = "";
            document.getElementById("ocCliente").value = "";
        }
   }


    // =======================
    // ARTÍCULOS
    // =======================
const articulos = {
    "F123456": {
        descripcion: "Martillo de acero 16oz",
        cantidad: 1,
        precio: 3490
    },
    "F123457": {
        descripcion: "Destornillador Philips",
        cantidad: 1,
        precio: 1500
    }
};

function buscarArticuloDesdeBoton(boton) {
    const fila = boton.closest("tr");
    const inputCodigo = fila.querySelector(".codigo-articulo");
    const codigo = inputCodigo.value.trim().toUpperCase();
    const datos = articulos[codigo];

    const hoy = new Date().toISOString().split("T")[0];
    const inputFecha = fila.querySelector(".fecha-solicitud");

    if (datos) {
        fila.querySelector(".descripcion").value = datos.descripcion;
        fila.querySelector(".cantidad").value = datos.cantidad;
        fila.querySelector(".precio").value = datos.precio.toLocaleString('es-CL');
        fila.querySelector(".total").value = (datos.precio * datos.cantidad).toLocaleString('es-CL');
        inputFecha.value = hoy;
    } else {
        alert("Artículo no encontrado.");
        fila.querySelector(".descripcion").value = "";
        fila.querySelector(".cantidad").value = "";
        fila.querySelector(".precio").value = "";
        fila.querySelector(".total").value = "";
        inputFecha.value = hoy;
    }
}

function recalcularTotal(input) {
    const fila = input.closest("tr");
    const cantidadTexto = fila.querySelector(".cantidad").value.replace(/\./g, '');
    const precioTexto = fila.querySelector(".precio").value.replace(/\./g, '');

    const cantidad = parseFloat(cantidadTexto);
    const precio = parseFloat(precioTexto);

    if (!isNaN(cantidad) && !isNaN(precio)) {
        const total = cantidad * precio;
        fila.querySelector(".total").value = total.toLocaleString('es-CL');
    } else {
        fila.querySelector(".total").value = '';
    }
}



// Función buscar proveedores
const proveedores = [
  { codigo: "P21555555-5", nombre: "Factoring S.A." },
  { codigo: "P12345666-6", nombre: "Pullman Cargo Factoring" },
  { codigo: "P98765432-1", nombre: "Servicios Ferreteros" },
  { codigo: "P22222222-2", nombre: "Sodimac Pro" }
];

let filaProveedorActiva = null;

function abrirModalProveedor(boton) {
  filaProveedorActiva = boton.closest("tr");
  document.getElementById("buscarRUT").value = "";
  cargarListaProveedores(proveedores);
  new bootstrap.Modal(document.getElementById("modalProveedores")).show();
}

function cargarListaProveedores(lista) {
  const cuerpo = document.getElementById("tablaProveedores");
  cuerpo.innerHTML = "";

  lista.forEach(p => {
    const fila = document.createElement("tr");
    fila.style.cursor = "pointer";
    fila.onclick = () => seleccionarProveedorDesdeModal(p.codigo);
    fila.innerHTML = `
      <td>${p.codigo}</td>
      <td>${p.nombre}</td>
    `;
    cuerpo.appendChild(fila);
  });
}

function filtrarProveedores() {
  const texto = document.getElementById("buscarRUT").value.toLowerCase();
  const filtrados = proveedores.filter(p =>
    p.codigo.toLowerCase().includes(texto) || p.nombre.toLowerCase().includes(texto)
  );
  cargarListaProveedores(filtrados);
}

function seleccionarProveedorDesdeModal(codigo) {
  if (filaProveedorActiva) {
    const input = filaProveedorActiva.querySelector(".proveedor");
    input.value = codigo;
  }
  bootstrap.Modal.getInstance(document.getElementById("modalProveedores")).hide();
}

// Asignar la fecha de hoy a cada campo
document.addEventListener('DOMContentLoaded', () => {
  const hoy = new Date().toISOString().split('T')[0];

  // Asignar la fecha de hoy a cada campo
  document.querySelectorAll('input[type="date"]').forEach(input => {
    input.value = hoy;
  });
});

// Cargar fecha de hoy en campos de fecha de anexo
document.querySelectorAll('.fecha-anexo').forEach(input => {
  input.value = new Date().toISOString().split('T')[0];
});

function procesarArchivo(input) {
  const fila = input.closest("tr");
  const archivo = input.files[0];

  if (archivo) {
    fila.querySelector(".ruta").value = input.value;
    fila.querySelector(".nombre-archivo").value = archivo.name;

    const fechaInput = fila.querySelector(".fecha-anexo");
    if (!fechaInput.value) {
      const hoy = new Date().toISOString().split("T")[0];
      fechaInput.value = hoy;
    }
  }
}

function visualizarArchivo(boton) {
  const fila = boton.closest("tr");
  const input = fila.querySelector(".archivo");
  if (input.files[0]) {
    const url = URL.createObjectURL(input.files[0]);
    window.open(url, "_blank");
  } else {
    alert("Primero debes seleccionar un archivo.");
  }
}

function borrarFila(boton) {
  const fila = boton.closest("tr");
  fila.remove();
  actualizarNumeracion();
}

function agregarFilaAnexo() {
  const tbody = document.getElementById("tablaAnexosBody");
  const filaOriginal = tbody.rows[0];
  const nuevaFila = filaOriginal.cloneNode(true);

  // Limpiar campos
  nuevaFila.querySelectorAll("input").forEach(input => {
    if (input.type === "file") {
      const nuevoInput = input.cloneNode();
      nuevoInput.value = "";
      nuevoInput.onchange = function () {
        procesarArchivo(this);
      };
      input.parentNode.replaceChild(nuevoInput, input);
    } else {
      input.value = "";
    }
  });

  tbody.appendChild(nuevaFila);
  actualizarNumeracion();
}

function actualizarNumeracion() {
  const filas = document.querySelectorAll("#tablaAnexosBody tr");
  filas.forEach((fila, i) => {
    fila.cells[0].textContent = i + 1;
  });
}
</script>
